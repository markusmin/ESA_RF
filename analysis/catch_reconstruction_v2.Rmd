---
title: "ESA Rockfishes - Catch Reconstruction"
author: "Markus Min"
date: "`r format(Sys.time(), '%B %d %Y')`"
toc: TRUE
toc-depth: 2
output: pdf_document
header-includes:
- \usepackage{fancyhdr}
urlcolor: blue
---
\makeatletter
\renewcommand\paragraph{\@startsection{paragraph}{5}{\z@}%
        {-2.5ex\@plus -1ex \@minus -.25ex}%
        {1.25ex \@plus .25ex}%
        {\normalfont\normalsize\bfseries}}
\makeatother


\pagestyle{fancy}
\fancyhead[L]{Catch Reconstruction}
\fancyhead[R]{2021 5-year review}
\fancyfoot[C]{\thepage}

### Description
This R markdown file will go through the catch reconstruction of yelloweye rockfish and bocaccio catch in Puget Sound. This document will generate different plausible catch scenarios and address the uncertainty at each step of the analysis. This analysis will go in reverse chronological order and go through commercial catch first and then recreational catch.. For more notes on the catch reconstruction, please see "catch_reconstruction.Rmd" in the same "analysis" folder.

Additionally, in accordance with the [2017 Rockfish Recovery Plan](https://www.fisheries.noaa.gov/resource/document/yelloweye-rockfish-and-bocaccio-recovery-plan), catches for three different geographic areas will be constructed:
1. The entire DPS (Canada and United States), minus the Hood Canal population
2. The Hood Canal population
3. The United States side of the DPS, excluding Hood Canal

```{r load_libraries, message = FALSE, echo = FALSE, warning = FALSE}
library(tidyverse)
library(readxl)
library(here)
library(ggthemes)
library(ggpubr)
library(janitor)

fig_dir <- here("figures", "catch_reconstruction")
```


# Commercial data

### First step: Load species composition data from Cyreis Schmitt
The first step in our analysis is to load the species composition tables from Cyreis Schmitt, as this data will be used for multiple time periods in the commercial catch.
```{r load_spp_comps, warning = FALSE, cache = TRUE}
## Load species composition tables
comp_table_path <- here("catch_reconstruction_data", "commercial", "schmitt_1991_table2_spp_comp_region_gear.xlsx")
trawl_comps <- read_excel(comp_table_path, sheet = "trawl")
set_net_comps <- read_excel(comp_table_path, sheet = "set_net")
set_line_comps <- read_excel(comp_table_path, sheet = "set_line")
troll_comps <- read_excel(comp_table_path, sheet = "troll")
jig_comps <- read_excel(comp_table_path, sheet = "jig")

# Convert all to long format, and format for joining

# trawl_comps
trawl_comps %>% 
  pivot_longer(cols = colnames(trawl_comps)[c(2:length(colnames(trawl_comps)))], names_to = "region") %>% 
  # Change percentages to proportions
  mutate(., value = value/100) %>% 
  # Keep only yelloweye and bocaccio
  subset(., species %in% c("Yelloweye", "Bocaccio")) %>% 
  mutate(., bocaccio_prop = ifelse(species == "Bocaccio", value, NA)) %>% 
  mutate(., yelloweye_prop = ifelse(species == "Yelloweye", value, NA)) %>% 
  # Drop species column now that it's in column name; also drop "value" (since these are now separated into boc and ye props)
  dplyr::select(-c(species, value)) %>% 
  # Merge rows together, replacing NAs
  group_by(region) %>% 
  summarise_each(funs(sum(., na.rm = TRUE))) -> trawl_comps_YE_boc
  # Add region numbers
  trawl_comps_YE_boc$REGION = c(5,1,4,3,2,6,7)
  # Add gear type column
  trawl_comps_YE_boc$gear <- "Bottom trawl"
  
# set_net_comps
set_net_comps %>% 
  pivot_longer(cols = colnames(set_net_comps)[c(2:length(colnames(set_net_comps)))], names_to = "region") %>% 
  # Change percentages to proportions
  mutate(., value = value/100) %>% 
  # Keep only yelloweye and bocaccio
  subset(., species %in% c("Yelloweye", "Bocaccio")) %>% 
  mutate(., bocaccio_prop = ifelse(species == "Bocaccio", value, NA)) %>% 
  mutate(., yelloweye_prop = ifelse(species == "Yelloweye", value, NA)) %>% 
  # Drop species column now that it's in column name; also drop "value" (since these are now separated into boc and ye props)
  dplyr::select(-c(species, value)) %>% 
  # Merge rows together, replacing NAs
  group_by(region) %>% 
  summarise_each(funs(sum(., na.rm = TRUE))) -> set_net_comps_YE_boc
  # Add region numbers
  set_net_comps_YE_boc$REGION = c(5,1,4,3,2,6,7)
  # Add gear type column
  set_net_comps_YE_boc$gear <- "Set net"
  
# set_line_comps
set_line_comps %>% 
  pivot_longer(cols = colnames(set_line_comps)[c(2:length(colnames(set_line_comps)))], names_to = "region") %>% 
  # Change percentages to proportions
  mutate(., value = value/100) %>% 
  # Keep only yelloweye and bocaccio
  subset(., species %in% c("Yelloweye", "Bocaccio")) %>% 
  mutate(., bocaccio_prop = ifelse(species == "Bocaccio", value, NA)) %>% 
  mutate(., yelloweye_prop = ifelse(species == "Yelloweye", value, NA)) %>% 
  # Drop species column now that it's in column name; also drop "value" (since these are now separated into boc and ye props)
  dplyr::select(-c(species, value)) %>% 
  # Merge rows together, replacing NAs
  group_by(region) %>% 
  summarise_each(funs(sum(., na.rm = TRUE))) -> set_line_comps_YE_boc
  # Add region numbers
  set_line_comps_YE_boc$REGION = c(5,1,4,3,2,6,7)
  # Add gear type column
  set_line_comps_YE_boc$gear <- "Set line"
  
# troll_comps
troll_comps %>% 
  pivot_longer(cols = colnames(troll_comps)[c(2:length(colnames(troll_comps)))], names_to = "region") %>% 
  # Change percentages to proportions
  mutate(., value = value/100) %>% 
  # Keep only yelloweye and bocaccio
  subset(., species %in% c("Yelloweye", "Bocaccio")) %>% 
  mutate(., bocaccio_prop = ifelse(species == "Bocaccio", value, NA)) %>% 
  mutate(., yelloweye_prop = ifelse(species == "Yelloweye", value, NA)) %>% 
  # Drop species column now that it's in column name; also drop "value" (since these are now separated into boc and ye props)
  dplyr::select(-c(species, value)) %>% 
  # Merge rows together, replacing NAs
  group_by(region) %>% 
  summarise_each(funs(sum(., na.rm = TRUE))) -> troll_comps_YE_boc
  # Add region numbers
  troll_comps_YE_boc$REGION = c(5,1,4,3,2,6,7)
  # Add gear type column
  troll_comps_YE_boc$gear <- "All troll"

# jig_comps
jig_comps %>% 
  pivot_longer(cols = colnames(jig_comps)[c(2:length(colnames(jig_comps)))], names_to = "region") %>% 
  # Change percentages to proportions
  mutate(., value = value/100) %>% 
  # Keep only yelloweye and bocaccio
  subset(., species %in% c("Yelloweye", "Bocaccio")) %>% 
  mutate(., bocaccio_prop = ifelse(species == "Bocaccio", value, NA)) %>% 
  mutate(., yelloweye_prop = ifelse(species == "Yelloweye", value, NA)) %>% 
  # Drop species column now that it's in column name; also drop "value" (since these are now separated into boc and ye props)
  dplyr::select(-c(species, value)) %>% 
  # Merge rows together, replacing NAs
  group_by(region) %>% 
  summarise_each(funs(sum(., na.rm = TRUE))) -> jig_comps_YE_boc
  # Add region numbers
  jig_comps_YE_boc$REGION = c(5,1,4,3,2,6,7)
  # Add gear type column
  # jig_comps_YE_boc$gear <- NA
  jig_comps_YE_boc$gear <- "Handline jig"
  
# Join all comp data together
trawl_comps_YE_boc %>% 
  bind_rows(., set_net_comps_YE_boc) %>% 
  bind_rows(., set_line_comps_YE_boc) %>% 
  bind_rows(., troll_comps_YE_boc) %>% 
  bind_rows(., jig_comps_YE_boc) -> comp_tables
```


## 2004-2020

#### Notes:
This data period is characterized by 1) low catches of bocaccio and yelloweye following regulatory changes and 2) relatively high confidence in the data.

#### Catch areas:
This data is split by region into the marine fish-shellfish marine catch reporting areas (WDFW). Areas in relation to DPSs:
1. Hood Canal: Regions 27A, 27B, and 27C. Note that Rickey's management region of "Hood Canal" includes area 25C in addition to these, but according to the rockfish recovery plan 25C is not part of the DPS. 27A appears to mostly be within the Hood Canal DPS, but a small section is outside.
2. U.S. DPS except Hood Canal: Everything else except areas 29 and 23C (these are West Juan de Fuca and outside of the DPS).


We are currently lacking regional resolution for this time period which should hopefully be fixed soon.

#### Yelloweye catch scenarios  
Yelloweye rockfish are a reporting category for this time period and as such will only have one catch estimate. 

#### Bocaccio catch scenarios  
Bocaccio rockfish are lumped into the "shelf rockfish" category and will have different catch scenarios (these could be amended if any species composition data comes available):

1. High catch: All "shelf rockfish" are bocaccio.
2. Medium catch: 50% of "shelf rockfish" are bocaccio.
3. Low catch: No "shelf rockfish" are bocaccio.

```{r 2004-2020_commercial_data, cache = TRUE}
PS_CL_1970_2020_path <- here("catch_reconstruction_data", "commercial", "Puget Sound commercial landings_1970-2020.xlsx")
PS_CL_1970_2020 <- read_excel(PS_CL_1970_2020_path, skip = 1, sheet = "By catch area")

# Create new categories and rename
PS_CL_1970_2020 %>% 
  dplyr::rename(catch_lbs = SumOfRoundPoundQuantity, year = Year, species = MarketSpeciesCategoryName) %>% 
  mutate(DPS = ifelse(CatchAreaCode %in% c("27A", "27B", "27C"), "Hood Canal",
                      ifelse(CatchAreaCode %in% c("29.0", "23C"), "Outside DPS","U.S. DPS except Hood Canal"))) %>% 
  dplyr::select(-c(CatchAreaCode, CatchAreaDescription, MarketSpeciesCategoryCode)) %>% 
  group_by(year, DPS, species) %>% 
  summarise(catch_lbs = sum(catch_lbs)) -> PS_CL_1970_2020


# Yelloweye are a market category; subset yelloweye
PS_CL_1970_2020 %>% 
  # Ungroup to prevent duplicated rows
  ungroup() %>% 
  subset(year >= 2004) %>% 
  subset(., species == "ROCKFISH (YELLOWEYE)") %>% 
  # Add zeros for years where there was no catch using tidyverse::complete
  complete(., DPS = c("U.S. DPS except Hood Canal", "Outside DPS", "Hood Canal"), year = seq(2004, 2020, 1), fill = list(catch_lbs = 0, species = "ROCKFISH (YELLOWEYE)")) %>% 
  subset(., DPS %in% c("U.S. DPS except Hood Canal", "Hood Canal")) %>% 
  # Drop species field
  dplyr::select(-species) -> YE_comm_2004_2020

# Generate three catch scenarios (all the same)
YE_comm_2004_2020 %>% 
  mutate(., high_catch = catch_lbs) %>% 
  mutate(., low_catch = catch_lbs) %>% 
  mutate(., medium_catch = catch_lbs) -> YE_comm_2004_2020 

# Bocaccio are not a market category, but are in the "shelf rockfish" group
PS_CL_1970_2020 %>% 
  # Ungroup to prevent duplicated rows
  ungroup() %>% 
  subset(year >= 2004) %>% 
  subset(., species == "SHELF ROCKFISH") %>% 
  # Add zeros for years where there was no catch using tidyverse::complete
  complete(., DPS = c("U.S. DPS except Hood Canal", "Outside DPS", "Hood Canal"), year = seq(2004, 2020, 1), fill = list(catch_lbs = 0, species = "SHELF ROCKFISH")) %>% 
  # Combine US side of DPS and Hood Canal for Bocaccio
  mutate(DPS = ifelse(DPS %in% c("Hood Canal", "U.S. DPS except Hood Canal"), "U.S. DPS", DPS)) %>% 
  group_by(year, DPS) %>% 
  summarise(catch_lbs = sum(catch_lbs))  %>% 
  subset(., DPS == "U.S. DPS") -> shelf_RF_comm_2004_2020

# Generate three catch scenarios
shelf_RF_comm_2004_2020 %>% 
  mutate(., high_catch = catch_lbs) %>% 
  mutate(., low_catch = 0) %>% 
  mutate(., medium_catch = 0.5*catch_lbs) -> shelf_RF_comm_2004_2020
```


## 1970-2003

#### Notes:
This data was provided by Wayne Palsson. For the time period 1970-2003, catch has already been prorated to species level based on catch composition data.

#### Yelloweye catch scenarios
Yelloweye rockfish was estimated by prorating total rockfish catch based on reliable catch composition data for this time period. However, region 3 (Strait of Juan de Fuca) is about half in and half out of the DPS, as such, the different catch scenarios concern whether or not this data is included:

1. High catch: All catch from the Strait of Juan de Fuca is included.
2. Medium catch: 50% of the catch from the Strait of Juan de Fuca is included.
3. Low catch: No catch from the Strait of Juan de Fuca is included.

#### Bocaccio catch scenarios
Bocaccio was estimated by prorating total rockfish catch based on reliable catch composition data for this time period and as such will only have one catch estimate. However, region 3 (Strait of Juan de Fuca) is about half in and half out of the DPS, as such, the different catch scenarios concern whether or not this data is included:

1. High catch: All catch from the Strait of Juan de Fuca is included.
2. Medium catch: 50% of the catch from the Strait of Juan de Fuca is included.
3. Low catch: No catch from the Strait of Juan de Fuca is included.

#### Prepare data
Here we load the HISCOM data and make edits to it, converting species, gear, and region codes to what they actually signify.
```{r load_HISCOM_data_and_edit, cache = TRUE}
HISCOM_path <- here("catch_reconstruction_data", "commercial", "HISCOM.xlsx")

HISCOM <- read_excel(HISCOM_path)

# Change types of certain columns
HISCOM %>% 
  mutate(., YEAR = as.numeric(YEAR)) %>% 
  mutate(., REGION = as.numeric(REGION)) %>% 
  mutate(EFFORT = as.numeric(EFFORT)) %>% 
  mutate(SPECIES = as.numeric(SPECIES)) %>% 
  dplyr::rename(species_code = SPECIES) -> HISCOM

# Change species column to species names rather than codes; use conversion table Wayne provided
recreational_weight_conversion_path <- here("catch_reconstruction_data", "recreational", "Recreationalconversion.xls")
recreational_weight_conversion <- read_excel(recreational_weight_conversion_path, sheet = "Sheet1", skip = 1)
recreational_weight_conversion %>% 
  dplyr::rename(species = "...2") %>% 
  dplyr::rename(species_code = "...1") %>% 
  # Drop weight conversions
  dplyr::select(-c(kg, lbs)) -> species_code_key

# Make some edits to make it consistent with the Rickey doc

# Add the missing codes
missing_codes <- data.frame(species_code = c(35, 36, 37), species = c("MONTHLY or ANNYAL TOTAL CATCH", "Total flatfish (excl. Pacific Halibut)", "Total rockfish"))
species_code_key <- dplyr::bind_rows(species_code_key, missing_codes)

species_code_key <- species_code_key[!is.na(species_code_key$species_code),]

# Merge on species_code; drop species_code
HISCOM %>% 
  dplyr::left_join(., species_code_key, by = "species_code") %>% 
  dplyr::select(-c(species_code)) -> HISCOM

# Change effort to text
effort_codes <- data.frame(EFFORT = c(1,2,3,4,5,6,7,8,9,10,11,12), gear = c("Handline jig", "Bottomfish troll (1980-)", "Other (salmon) troll (1980-)", "Set line", "Set net", "Salmon net", "Drag seine", "Other gear types", "Bottom trawl", "Midwater trawl", "Total commercial effort", "All (combined) troll (1970-1979)"))
# Merge on EFFORT; drop EFFORT
HISCOM %>% 
  dplyr::left_join(., effort_codes, by = "EFFORT") %>% 
  dplyr::select(-c(EFFORT)) -> HISCOM

# Create a region code to region name key (from Rickey)
HISCOM_regions <- data.frame(REGION = c(1,2,3,4,5,6,7,8,9), region = c("Gulf - Bellingham", "San Juan Islands", "Strait of Juan de Fuca", "Hood Canal", "Central Puget Sound", "Southern Puget Sound", "West Juan de Fuca", "PS + West Juan de Fuca", "All PS"))
# Change region numbers to region names
HISCOM %>% 
  left_join(., HISCOM_regions, by = "REGION") -> HISCOM
```

```{r subset_species_HISCOM, cache = TRUE}
# Subset yelloweye
HISCOM %>% 
  subset(., gear == "Total commercial effort") %>% 
  subset(., species == "Yelloweye rockfish") %>% 
  dplyr::select(c(YEAR, region, gear, TOTAL)) %>% 
  dplyr::rename(year = YEAR) %>% 
  # Add zeros for years where there was no catch using tidyverse::complete
  ungroup() %>% 
  complete(., region = c("Gulf - Bellingham", "San Juan Islands", "Strait of Juan de Fuca", "Hood Canal", "Central Puget Sound", "Southern Puget Sound", "West Juan de Fuca", "PS + West Juan de Fuca", "All PS"), gear = "Total commercial effort", year = seq(1955, 2003, 1), fill = list(TOTAL = 0)) -> YE_HISCOM

# Subset Hood Canal population - only one estimate
YE_HISCOM %>% 
  subset(., region == "Hood Canal") %>% 
  mutate(., DPS = "Hood Canal")  %>% 
  # add columns for joining
  mutate(., high_catch = TOTAL) %>% 
  mutate(., low_catch = TOTAL) %>% 
  mutate(., medium_catch = TOTAL) %>% 
  dplyr::rename(., catch_lbs = TOTAL) %>% 
  dplyr::select(-c(region, gear)) -> YE_HISCOM_hood_canal

# High catch scenario - including all catch from Strait of Juan de Fuca
YE_HISCOM %>% 
  subset(., region == "All PS") %>% 
  mutate(., DPS = "U.S. DPS except Hood Canal") %>% 
  dplyr::rename(high_catch = TOTAL) -> YE_HISCOM_USDPS_high

# Medium catch scenario - including 50% of catch from Strait of Juan de Fuca
YE_HISCOM %>% 
  subset(., region %in% c("All PS", "Strait of Juan de Fuca")) %>% 
  group_by(year) %>% 
  mutate(medium_catch = TOTAL - 0.5*TOTAL[region == "Strait of Juan de Fuca"]) %>% 
  mutate(., DPS = "U.S. DPS except Hood Canal") %>% 
  subset(., region == "All PS") -> YE_HISCOM_USDPS_medium

# Low catch scenario - including no catch from Strait of Juan de Fuca
YE_HISCOM %>% 
  subset(., region %in% c("All PS", "Strait of Juan de Fuca")) %>% 
  group_by(year) %>% 
  mutate(low_catch = TOTAL - TOTAL[region == "Strait of Juan de Fuca"]) %>% 
  mutate(., DPS = "U.S. DPS except Hood Canal") %>% 
  subset(., region == "All PS") -> YE_HISCOM_USDPS_low

# Subset bocaccio
HISCOM %>% 
  subset(., gear == "Total commercial effort") %>% 
  subset(., species == "Bocaccio") %>% 
  dplyr::select(c(YEAR, region, gear, TOTAL)) %>% 
  dplyr::rename(year = YEAR) %>% 
  # Add zeros for years where there was no catch using tidyverse::complete
  ungroup() %>% 
  complete(., region = c("Gulf - Bellingham", "San Juan Islands", "Strait of Juan de Fuca", "Hood Canal", "Central Puget Sound", "Southern Puget Sound", "West Juan de Fuca", "PS + West Juan de Fuca", "All PS"), gear = "Total commercial effort", year = seq(1955, 2003, 1), fill = list(TOTAL = 0)) -> BOC_HISCOM

# High catch scenario - including all catch from Strait of Juan de Fuca
BOC_HISCOM %>% 
  subset(., region == "All PS") %>% 
  mutate(., DPS = "U.S. DPS") %>% 
  dplyr::rename(high_catch = TOTAL) -> BOC_HISCOM_USDPS_high

# Medium catch scenario - including 50% of catch from Strait of Juan de Fuca
BOC_HISCOM %>% 
  subset(., region %in% c("All PS", "Strait of Juan de Fuca")) %>% 
  group_by(year) %>% 
  mutate(medium_catch = TOTAL - 0.5*TOTAL[region == "Strait of Juan de Fuca"]) %>% 
  mutate(., DPS = "U.S. DPS") %>% 
  subset(., region == "All PS") -> BOC_HISCOM_USDPS_medium

# Medium catch scenario - including no catch from Strait of Juan de Fuca
BOC_HISCOM %>% 
  subset(., region %in% c("All PS", "Strait of Juan de Fuca")) %>% 
  group_by(year) %>% 
  mutate(low_catch = TOTAL - TOTAL[region == "Strait of Juan de Fuca"]) %>% 
  mutate(., DPS = "U.S. DPS") %>% 
  subset(., region == "All PS") -> BOC_HISCOM_USDPS_low
```

```{r make_exploratory_plots, cache = TRUE}
# Plot catch of yelloweye and bocaccio by region, to get a visual on how sensitive estimates will be to exclusion of Strait of Juan de Fuca data
YE_HISCOM_plot_region <- ggplot(subset(YE_HISCOM, !(region %in% c("All PS", "PS + West Juan de Fuca", "West Juan de Fuca"))), aes(x = year, y = TOTAL, fill = region)) +
  geom_bar(stat = "identity") +
  ggtitle("Yelloweye catch by region, 1955-2003") +
  scale_fill_tableau(palette = "Tableau 10")

ggsave(paste0(fig_dir, "/YE_HISCOM_plot_region.png"), YE_HISCOM_plot_region, height = 8, width = 10)

BOC_HISCOM_plot_region <- ggplot(subset(BOC_HISCOM, !(region %in% c("All PS", "PS + West Juan de Fuca", "West Juan de Fuca"))), aes(x = year, y = TOTAL, fill = region)) +
  geom_bar(stat = "identity") +
  ggtitle("Bocaccio catch by region, 1955-2003") +
  scale_fill_tableau(palette = "Tableau 10")

ggsave(paste0(fig_dir, "/BOC_HISCOM_plot_region.png"), BOC_HISCOM_plot_region, height = 8, width = 10)
```



```{r reformat_data_for_analysis, cache = TRUE}
YE_HISCOM_USDPS_low %>% 
  left_join(., YE_HISCOM_USDPS_medium, by = c("year", "region", "gear", "TOTAL", "DPS")) %>% 
  left_join(., YE_HISCOM_USDPS_high, by = c("year", "region", "gear", "DPS")) %>% 
  dplyr::rename(catch_lbs = TOTAL) %>% 
  dplyr::select(-c(region, gear)) %>% 
  # Add hood canal data
  bind_rows(., YE_HISCOM_hood_canal) %>% 
  # Subset years
  subset(., year >= 1970) -> YE_comm_1970_2003

BOC_HISCOM_USDPS_low %>% 
  left_join(., BOC_HISCOM_USDPS_medium, by = c("year", "region", "gear", "TOTAL", "DPS")) %>% 
  left_join(., BOC_HISCOM_USDPS_high, by = c("year", "region", "gear", "DPS")) %>% 
  dplyr::rename(catch_lbs = TOTAL) %>% 
  dplyr::select(-c(region, gear)) %>% 
  # Subset years
  subset(., year >= 1970) -> BOC_comm_1970_2003
```

## 1955-1969

#### Notes:
This data was provided by Wayne Palsson. For this time period, we have three categories for rockfish: "general rockfish", "red snapper", and "black rockfish". We do not have any catch composition data for this time period.

There are two main decisions to make regarding this time period:
1) Are yelloweye catches for this time period limited to "red snapper", or is it possible that in addition to "red snapper" there are actually yelloweye in the "general rockfish" category?
2) Should catches from the Strait of Juan de Fuca be included?

For now, we will assume that yelloweye catch is only the "red snapper" catch. Bocaccio catch will be prorated based on the 1970-1987 catch composition data from Schmitt 1991.

We also have "red snapper" already from the HISCOM data, so we just need to re-subset that dataframe for the appropriate timeframe.
 Another interesting note: West Juan de Fuca (region 7) was not used until 1970. Does this mean that there was no catch from this region until 1970 when it abruptly started, or was this due to a change in regional reporting requirements? i.e. were Strait of Juan de Fuca and West Juan de Fuca one region prior to 1970?

#### Yelloweye catch scenarios
Region 3 (Strait of Juan de Fuca) is about half in and half out of the DPS, as such, the different catch scenarios concern whether or not this data is included:

1. High catch: All "red snapper" catch from the Strait of Juan de Fuca is included.
2. Medium catch: 50% of the "red snapper" catch from the Strait of Juan de Fuca is included.
3. Low catch: No "red snapper" catch from the Strait of Juan de Fuca is included.

#### Bocaccio catch scenarios
For the time period 1955-1969, for the Strait of Juan de Fuca (region 3), there are only the following gear types: All troll, Drag seine, Bottom trawl, Set net and Salmon net. According to the species composition table from Cyreis Schmitt, none of these gear types ever caught Bocaccio in the Strait of Juan de Fuca. Thus the catch of Bocaccio will not be affected by how much of the Strait of Juan de Fuca catch is included in the catch estimates.

Therefore, there is only one estimate of Bocaccio from this time period.
```{r 1955_1969_catch, cache = TRUE}
# Yelloweye
YE_HISCOM_USDPS_low %>% 
  left_join(., YE_HISCOM_USDPS_medium, by = c("year", "region", "gear", "TOTAL", "DPS")) %>% 
  left_join(., YE_HISCOM_USDPS_high, by = c("year", "region", "gear", "DPS")) %>% 
  dplyr::rename(catch_lbs = TOTAL) %>% 
  dplyr::select(-c(region, gear)) %>% 
  # Add hood canal data
  bind_rows(., YE_HISCOM_hood_canal) %>% 
  # Subset years
  subset(., year >= 1955 & year <= 1969) -> YE_comm_1955_1969

# Bocaccio
# Prorate Bocaccio catch based on species composition tables from Cyreis Schmitt
comp_tables

HISCOM %>% 
  # Subset years for which we need to prorate catch
  subset(., YEAR >= 1955 & YEAR <= 1969) %>% 
  # Subset only unidentified rockfishes (for this time period, it is all rockfish that aren't "red snapper" or "black rockfish")
  subset(., species %in% c("Misc. rockfish")) %>% 
  dplyr::select(c(YEAR, REGION, region, gear, TOTAL, species)) %>% 
  # Drop the total commercial effort category
  subset(., gear != "Total commercial effort") %>% 
  # combine the troll categories
    mutate(gear = ifelse(gear %in% c("All (combined) troll (1970-1979)", "Bottomfish troll (1980-)", "Other (salmon) troll (1980-)"), "All troll", gear)) %>% 
  # Remove the summary regions
  subset(., !(region == "All PS")) %>% 
  # Add the comp table data
  left_join(., dplyr::select(comp_tables, -region), by = c("REGION", "gear")) %>% 
  # Multiple TOTAL by prop to get catch
  mutate(., bocaccio_catch_estimate = bocaccio_prop*TOTAL) -> boc_55_69_prorated

# summarise across years, rename columns
boc_55_69_prorated %>% 
  dplyr::rename(year = YEAR) %>% 
  group_by(year) %>% 
  summarise(catch_lbs = sum(bocaccio_catch_estimate, na.rm = TRUE)) %>% 
  mutate(DPS = "U.S. DPS") %>% 
  mutate(., high_catch = catch_lbs) %>% 
  mutate(., medium_catch = catch_lbs) %>% 
  mutate(., low_catch = catch_lbs) -> BOC_comm_55_69
```

## 1943-1954

### Notes:
This data comes from the yellow book. We do not have any region-specific information for this time period, but we do have catches by gear.

The main decision for this time period is how to estimate the catch by region. While the yellow book does not have regional information, the bound volume data does. The bound volume catch estimates are very similar to those of the yellow book, especially for the later period (1955 onwards). At that point, should we just use the bound volume data, instead of using the yellow book for total catch and gear type and bound volume data to estimate regional proportions?

We will first compare yellow book and bound volume data for this time period.
- Based on a visual comparison of yellow book and bound volume data for 1955-1960, all regions look fairly comparable except for the "Gulf - Bellingham" region, which has higher values in the yellow book.

Main decisions for this time period:

1. Do we use the catch composition data for 1970-1987 (20-40 years after this time period)? I don't see what other data we could use.
2. What gear and region information do we use?
+ Yellow book gear information, multiplied by the regional proportions from the bound volume data
+ All data from bound volumes (total catch, gear, and region)
+ Yellow book catch totals, prorated by gear and region from the bound volumes (this feels really inaccurate).
+ Bound volume data multiplied by a conversion factor that is equal to mean yellow book divided by mean bound volume catch?

```{r load_yellowbook_data, cache = TRUE}
yellowbook_path <- here("catch_reconstruction_data", "commercial", "yellowbook_1921_1954.csv")

yellowbook <- read.csv(yellowbook_path)

# convert to long format; drop non-gear type names
yellowbook %>% 
  dplyr::select(-c(total, species)) %>% 
  pivot_longer(., cols = colnames(yellowbook)[!colnames(yellowbook) %in% c("year", "species", "total")], names_to = "gear") -> yb_long

# Add source column
yb_long %>% 
  mutate(source = "Yellow Book") -> yb_long

# Fill NAs with zeros
yb_long[is.na(yb_long$value),]$value <- 0

# Rename gear types to match with bound volumes
unique(yb_long$gear)
yb_long %>% 
  mutate(gear = ifelse(gear == "pound_net", "Pound Net",gear)) %>% 
  mutate(gear = ifelse(gear == "drag_seine", "Drag Seine",gear)) %>% 
  mutate(gear = ifelse(gear == "set_net", "Set Net",gear)) %>% 
  mutate(gear = ifelse(gear == "otter_trawl", "Trawl",gear)) %>% 
  mutate(gear = ifelse(gear == "handline_troll", "Troll",gear)) %>% 
  mutate(gear = ifelse(gear == "set_line", "Set line",gear)) %>% 
  mutate(gear = ifelse(gear == "beam_trawl", "Trawl",gear)) %>% 
  mutate(gear = ifelse(gear == "other_gear", "Other",gear))  -> yb_long
```

```{r load_BV_data, warning = FALSE, cache = TRUE}
BV_path <- here("catch_reconstruction_data", "commercial", "boundvolumes_OLDMFLnData36_60_ROCKFISH.xlsx")

BV_1936_60 <- read_excel(BV_path)

BV_35_42_path <- here("catch_reconstruction_data", "commercial", "boundvolumes_OLDMFLnData35_42_12570_Inc_wEdits.xlsx")

BV_1935_42 <- read_excel(BV_35_42_path)
# Subset rockfish
BV_1935_42 %>% 
  subset(., Species_Orig == "ROCK COD")  -> BV_1935_42

# Combine two dfs
setdiff(colnames(BV_1935_42), colnames(BV_1936_60))
setdiff(colnames(BV_1936_60), colnames(BV_1935_42))

# Drop the columns that aren't in both (these aren't informative)
# Rename certain columns

BV_1935_42 %>% 
  dplyr::select(-c("XRefSpeciesID_Fkey", "Utilization",  "XRef_GearCodeID _Fkey", "XRefAreaID_Fkey")) %>% 
  dplyr::rename(Norm_AmtLanded = Amount_Landed_Normalized) -> BV_1935_42

BV_1936_60 %>% 
  dplyr::select(-c(Select4Edit)) -> BV_1936_60

BV_1935_42 %>% 
  bind_rows(., BV_1936_60) -> BV_1935_60

# Load the catch area to region key
BC_catcharea_key_path <- here("catch_reconstruction_data", "commercial", "boundvolume_catcharea_key.xlsx")
BC_catcharea_key <- read_excel(BC_catcharea_key_path)

# Combine the two catch area columns, join with key
BV_1935_60 %>% 
  mutate(., catch_area = ifelse(is.na(Norm_CatchArea), CatchArea_Orig, Norm_CatchArea)) %>% 
  left_join(., BC_catcharea_key, by = "catch_area") -> BV_1935_60

# Drop the data from outside PS
BV_1935_60 %>% 
  subset(., !(region %in% c("OUTSIDE", "COAST", "COLUMBIA RIVER", "UNKNOWN"))) -> BV_PS

# Edit gears
BV_PS %>% 
  mutate(., gear = ifelse(is.na(Norm_Gear), Gear_Orig, Norm_Gear)) %>% 
  mutate(gear = ifelse(gear %in% c("BT", "Trawl - Otter", "Trawl - Beam"), "Trawl", gear)) %>% 
  mutate(gear = ifelse(gear %in% c("DS", "Drag Seine"), "Drag Seine", gear)) %>%          
  mutate(gear = ifelse(gear %in% c("H&L", "HL", "Hook and Line"), "Hook and Line", gear)) %>%   
  mutate(gear = ifelse(gear %in% c("SL", "Longline/Set Line"), "Set line", gear)) %>%     
  mutate(gear = ifelse(gear %in% c("PS", "Purse Seine", "Purse Seine  - (salmon)"), "Purse seine", gear)) %>%   
  mutate(gear = ifelse(gear %in% c("Troll - Unknown", "Troll - (salmon)", "Troll - Bottomfish"), "Troll", gear)) %>%    
  mutate(gear = ifelse(gear %in% c("Handline/Jigger"), "Handline jig", gear)) %>%    
  mutate(gear = ifelse(gear %in% c("Set Net/Gillnet - Tribal", "Drag Seine - Tribal"), "Tribal Fisheries", gear)) %>%    
  mutate(gear = ifelse(gear %in% c("Not reported", "Trap - Shellfish Pot (Dungeness)", "Beach Seine", "Gillnet - Drift (Salmon)"), "Other", gear)) -> BV_PS
           
unique(BV_PS$gear)

subset(BV_PS, YearLanded_Orig == 1941)

# Summarize by year to compare with yellow book data
BV_PS %>% 
  dplyr::select(YearLanded_Orig, Norm_AmtLanded) %>% 
  group_by(YearLanded_Orig) %>% 
  summarise(annual_catch = sum(Norm_AmtLanded, na.rm = TRUE)) %>% 
  mutate(data_source = "Bound Volumes")-> BV_PS_annual_sums

# Reformat to join with yellow book data
BV_PS %>% 
  dplyr::rename(year = YearLanded_Orig, value = Norm_AmtLanded) %>% 
  dplyr::select(year, value, gear, region) %>% 
  # Sum by region, gear, and year
  group_by(year, gear, region) %>% 
  summarise(value = sum(value)) %>% 
  # Use complete to fill in zeros for missing year-gear-region combinations
  ungroup() %>% 
  complete(., region = c("Gulf - Bellingham", "San Juan Islands", "Strait of Juan de Fuca", "Hood Canal", "Central Puget Sound", "Southern Puget Sound"), gear = c("Trawl", "Drag Seine", "Hook and Line", "Set line", "Purse seine", "Troll", "Other", "Set Net",  "Handline jig", "Tribal Fisheries"), year = seq(1935, 1960, 1), fill = list(value = 0)) %>% 
  mutate(., source = "Bound Volumes") -> BV_PS_sums

```

```{r compare_BV_YB_totals, cache = TRUE}
BV_PS_sums %>% 
  bind_rows(., yb_long) -> BV_YB

# Plot BV catch by region
BV_catch_by_region <- ggplot(BV_PS_sums, aes(x = year, y = value, fill = region)) +
  geom_bar(stat = "identity")+
  scale_fill_tableau(palette = "Tableau 10")+
  ggtitle("Bound volume catch by region")+
  ylab("Proportion of catch") + 
  xlab("Year")

ggsave(paste0(fig_dir, "/BV_catch_by_region.png"), BV_catch_by_region, height = 8, width = 10)

# Bound Volumes - Plot total catch by gear type
BV_gear <- ggplot(subset(BV_YB, source == "Bound Volumes" & year >= 1943 & year <= 1954), aes(x = year, y = value, fill = gear)) +
  geom_bar(stat = "identity")+
  scale_fill_tableau(palette = "Tableau 10")+
  ggtitle("Bound volume catch by gear")+
  ylab("Proportion of catch") + 
  xlab("Year")

ggsave(paste0(fig_dir, "/BV_gear.png"), BV_gear, height = 8, width = 10)

# Yellow Book - Plot total catch by gear type
YB_gear <- ggplot(subset(BV_YB, source == "Yellow Book" & year >= 1943 & year <= 1954), aes(x = year, y = value, fill = gear)) +
  geom_bar(stat = "identity")+
  scale_fill_tableau(palette = "Tableau 10")+
  ggtitle("Yellow Book catch by gear")+
  ylab("Proportion of catch") + 
  xlab("Year")

ggsave(paste0(fig_dir, "/YB_gear.png"), YB_gear, height = 8, width = 10)

```

#### Approach 1: Using the bound volume data as is
Gear categories in bound volume data that are missing from the species composition data: "Drag Seine", "Hook and Line", "Other", "Purse seine", "Tribal Fisheries". The biggest category of these is the "drag seine" category.

Note: With this approach, we are just calculating all of the bound volume data at the same time (including the period 1935-1942).

##### Yelloweye catch scenarios
Region 3 (Strait of Juan de Fuca) is about half in and half out of the DPS, as such, the different catch scenarios concern whether or not this data is included:

1. High catch: All prorated catch from the Strait of Juan de Fuca is included.
2. Medium catch: 50% of the prorated catch from the Strait of Juan de Fuca is included.
3. Low catch: No prorated catch from the Strait of Juan de Fuca is included.

##### Bocaccio catch scenarios
Region 3 (Strait of Juan de Fuca) is about half in and half out of the DPS, as such, the different catch scenarios concern whether or not this data is included:

1. High catch: All prorated catch from the Strait of Juan de Fuca is included.
2. Medium catch: 50% of the prorated catch from the Strait of Juan de Fuca is included.
3. Low catch: No prorated catch from the Strait of Juan de Fuca is included.

```{r prorate_BV_data, cache = TRUE}
# Rename comp_tables regions/gears for joining with BV
comp_tables %>% 
  # Regions
  mutate(region = ifelse(region == "central_sound", "Central Puget Sound", region)) %>% 
  mutate(region = ifelse(region == "gulf_bellingham", "Gulf - Bellingham", region)) %>% 
  mutate(region = ifelse(region == "hood_canal", "Hood Canal", region)) %>% 
  mutate(region = ifelse(region == "juan_de_fuca", "Strait of Juan de Fuca", region)) %>% 
  mutate(region = ifelse(region == "san_juan_islands",  "San Juan Islands", region)) %>% 
  mutate(region = ifelse(region == "south_sound", "Southern Puget Sound", region)) %>% 
  mutate(region = ifelse(region == "west_juan_de_fuca", "West Juan de Fuca", region)) %>% 
  # Gears
  mutate(gear = ifelse(gear == "Bottom trawl", "Trawl", gear)) %>% 
  mutate(gear = ifelse(gear == "Set net", "Set Net", gear)) %>% 
  mutate(gear = ifelse(gear == "All troll", "Troll", gear)) -> comp_tables_BV

# unique(comp_tables_BV$gear)
# unique(BV_PS_sums$gear)
setdiff(unique(BV_PS_sums$gear), unique(comp_tables_BV$gear))

BV_PS_sums %>% 
  left_join(., comp_tables_BV, by = c("region", "gear")) %>% 
  mutate(., YE_catch_estimate = value * yelloweye_prop) %>% 
  mutate(., BOC_catch_estimate = value * bocaccio_prop) -> BV_PS_sums_prorate

# sum across each year and region

# Yelloweye
BV_PS_sums_prorate %>% 
  group_by(year, region) %>% 
  summarise(catch_lbs = sum(YE_catch_estimate, na.rm = TRUE)) -> BV_PS_ye_prorated

# Subset Hood Canal
BV_PS_ye_prorated %>% 
  subset(., region == "Hood Canal") %>% 
  dplyr::rename(DPS = region) -> BV_hood_canal_ye_prorated

# Calculate U.S. DPS minus Hood Canal
BV_PS_ye_prorated %>% 
  mutate(., area = ifelse(region != "Hood Canal", "All PS", region)) %>% 
  group_by(year, area) %>% 
  summarise(catch_lbs = sum(catch_lbs))  %>% 
  subset(., area == "All PS") -> BV_PS_ye_sums
 
# Subset Strait of Juan de Fuca
BV_PS_ye_prorated %>% 
  subset(., region == "Strait of Juan de Fuca") %>% 
  mutate(., area = "Strait of Juan de Fuca") -> BV_jdf_ye_prorated

# Join US DPS and Strait of JDF
BV_PS_JDF_ye_sums <- bind_rows(BV_PS_ye_sums, BV_jdf_ye_prorated)

# Low catch scenario - including no catch from Strait of Juan de Fuca
BV_PS_JDF_ye_sums  %>% 
  group_by(year) %>% 
  mutate(low_catch = catch_lbs - catch_lbs[area == "Strait of Juan de Fuca"]) %>% 
  mutate(., DPS = "U.S. DPS except Hood Canal") %>% 
  subset(., area == "All PS") -> YE_BV_USDPS_low

# Medium catch scenario - including no catch from Strait of Juan de Fuca
BV_PS_JDF_ye_sums  %>% 
  group_by(year) %>% 
  mutate(medium_catch = catch_lbs - 0.5*catch_lbs[area == "Strait of Juan de Fuca"]) %>% 
  mutate(., DPS = "U.S. DPS except Hood Canal") %>% 
  subset(., area == "All PS") -> YE_BV_USDPS_medium

# High catch scenario - including no catch from Strait of Juan de Fuca
BV_PS_JDF_ye_sums  %>% 
  group_by(year) %>% 
  mutate(high_catch = catch_lbs - 0*catch_lbs[area == "Strait of Juan de Fuca"]) %>% 
  mutate(., DPS = "U.S. DPS except Hood Canal") %>% 
  subset(., area == "All PS") -> YE_BV_USDPS_high

# Combine all catch scenarios
YE_BV_USDPS_low %>% 
  left_join(., YE_BV_USDPS_medium, by = c("year", "area", "DPS", "region", "catch_lbs")) %>% 
  left_join(., YE_BV_USDPS_high, by = c("year", "area", "DPS", "region", "catch_lbs")) %>% 
  dplyr::select(-c(region, area)) %>% 
  # add hood canal data
  bind_rows(., BV_hood_canal_ye_prorated) %>% 
  # Subset years
  subset(., year <= 1954) -> YE_BV_comm_1935_1954

###### Bocaccio
BV_PS_sums_prorate %>% 
  group_by(year, region) %>% 
  summarise(catch_lbs = sum(BOC_catch_estimate, na.rm = TRUE)) -> BV_PS_BOC_prorated

# Calculate U.S. DPS minus Hood Canal
BV_PS_BOC_prorated %>% 
  mutate(., area = "All PS") %>% 
  group_by(year, area) %>% 
  summarise(catch_lbs = sum(catch_lbs))  -> BV_PS_BOC_sums
 
# Subset Strait of Juan de Fuca
BV_PS_BOC_prorated %>% 
  subset(., region == "Strait of Juan de Fuca") %>% 
  mutate(., area = "Strait of Juan de Fuca") -> BV_jdf_BOC_prorated

# Join US DPS and Strait of JDF
BV_PS_JDF_BOC_sums <- bind_rows(BV_PS_BOC_sums, BV_jdf_BOC_prorated)

# Low catch scenario - including no catch from Strait of Juan de Fuca
BV_PS_JDF_BOC_sums  %>% 
  group_by(year) %>% 
  mutate(low_catch = catch_lbs - catch_lbs[area == "Strait of Juan de Fuca"]) %>% 
  mutate(., DPS = "U.S. DPS") %>% 
  subset(., area == "All PS") -> BOC_BV_USDPS_low

# Medium catch scenario - including no catch from Strait of Juan de Fuca
BV_PS_JDF_BOC_sums  %>% 
  group_by(year) %>% 
  mutate(medium_catch = catch_lbs - 0.5*catch_lbs[area == "Strait of Juan de Fuca"]) %>% 
  mutate(., DPS = "U.S. DPS") %>% 
  subset(., area == "All PS") -> BOC_BV_USDPS_medium

# High catch scenario - including no catch from Strait of Juan de Fuca
BV_PS_JDF_BOC_sums  %>% 
  group_by(year) %>% 
  mutate(high_catch = catch_lbs - 0*catch_lbs[area == "Strait of Juan de Fuca"]) %>% 
  mutate(., DPS = "U.S. DPS") %>% 
  subset(., area == "All PS") -> BOC_BV_USDPS_high

# Combine all catch scenarios
BOC_BV_USDPS_low %>% 
  left_join(., BOC_BV_USDPS_medium, by = c("year", "area", "DPS", "region", "catch_lbs")) %>% 
  left_join(., BOC_BV_USDPS_high, by = c("year", "area", "DPS", "region", "catch_lbs")) %>% 
  dplyr::select(-c(region, area)) %>% 
  # Subset years
  subset(., year <= 1954) -> BOC_BV_comm_1935_1954

```

## 1921-1933

### Notes:
This data comes from the yellow book. We do not have any region-specific information for this time period, but we do have catches by gear. Catches from this time period are also very low compared to later stages of the time series.

The main decision for this time period is how to estimate the catch by region. I am additionally unaware of any information that would give us an indication of region-specific effort.

Main decisions for this time period:

1. How do we prorate the catches by region?
+ From the data, we know that as a proportion of total catch, certain regions increased over time and others decreased. For example, the Strait of Juan de Fuca becomes increasingly important over time.

In the absence of regional information, we will use different plausible scenarios for catch by region:

##### Effort by region
These estimates are based on a subjective estimate of proportion of effort in the late 30s/early 40s (the time period closest to this one that has regional information).

| Region | Percentage of Effort |
|-|-|
| Central Puget Sound | 35% |
| Gulf - Bellingham | 15% |
| Hood Canal | 5% |
| San Juan Islands | 10% |
| Southern Puget Sound | 30% |
| Strait of Juan de Fuca | 5% |

I will use this table to prorate catch, based on a gear + region (from the Schmitt et al. 1991 table, which is admittedly from half a century later).

##### Yelloweye catch scenarios
This time period has a huge amount of uncertainty, but also has minimal data and thus the different catch scenarios are unlikely to make much of a difference to stock status.

1. High catch: Double the prorated catch (2x estimates).
2. Medium catch: The prorated catch (1x estimates).
3. Low catch: Half of the prorated catch (0.5x estimates).

##### Bocaccio catch scenarios
This time period has a huge amount of uncertainty, but also has minimal data and thus the different catch scenarios are unlikely to make much of a difference to stock status.

1. High catch: Double the prorated catch (2x estimates).
2. Medium catch: The prorated catch (1x estimates).
3. Low catch: Half of the prorated catch (0.5x estimates).

```{r prorate_yellowbook_1921_1933, cache = TRUE}
### Central Puget Sound

# Yelloweye
yb_long %>% 
  subset(year <= 1933) %>% 
  mutate(., region = "Central Puget Sound") %>% 
  mutate(., est_catch = 0.35*value) %>% 
  left_join(., comp_tables_BV, by = c("region", "gear")) %>% 
  mutate(., catch_lbs = est_catch*yelloweye_prop) %>% 
  dplyr::select(-c(bocaccio_prop, REGION)) -> ye_CPS_21_33

# Bocaccio
yb_long %>% 
  subset(year <= 1933) %>% 
  mutate(., region = "Central Puget Sound") %>% 
  mutate(., est_catch = 0.35*value) %>% 
  left_join(., comp_tables_BV, by = c("region", "gear")) %>% 
  mutate(., catch_lbs = est_catch*bocaccio_prop) %>% 
  dplyr::select(-c(yelloweye_prop, REGION)) -> boc_CPS_21_33

### Gulf - Bellingham

# Yelloweye
yb_long %>% 
  subset(year <= 1933) %>% 
  mutate(., region = "Gulf - Bellingham") %>% 
  mutate(., est_catch = 0.15*value) %>% 
  left_join(., comp_tables_BV, by = c("region", "gear")) %>% 
  mutate(., catch_lbs = est_catch*yelloweye_prop) %>% 
  dplyr::select(-c(bocaccio_prop, REGION)) -> ye_GB_21_33

# Bocaccio
yb_long %>% 
  subset(year <= 1933) %>% 
  mutate(., region = "Gulf - Bellingham") %>% 
  mutate(., est_catch = 0.15*value) %>% 
  left_join(., comp_tables_BV, by = c("region", "gear")) %>% 
  mutate(., catch_lbs = est_catch*bocaccio_prop) %>% 
  dplyr::select(-c(yelloweye_prop, REGION)) -> boc_GB_21_33

### Hood Canal

# Yelloweye
yb_long %>% 
  subset(year <= 1933) %>% 
  mutate(., region = "Hood Canal") %>% 
  mutate(., est_catch = 0.05*value) %>% 
  left_join(., comp_tables_BV, by = c("region", "gear")) %>% 
  mutate(., catch_lbs = est_catch*yelloweye_prop) %>% 
  dplyr::select(-c(bocaccio_prop, REGION)) -> ye_HC_21_33

# Bocaccio
yb_long %>% 
  subset(year <= 1933) %>% 
  mutate(., region = "Hood Canal") %>% 
  mutate(., est_catch = 0.05*value) %>% 
  left_join(., comp_tables_BV, by = c("region", "gear")) %>% 
  mutate(., catch_lbs = est_catch*bocaccio_prop) %>% 
  dplyr::select(-c(yelloweye_prop, REGION)) -> boc_HC_21_33

### San Juan Islands

# Yelloweye
yb_long %>% 
  subset(year <= 1933) %>% 
  mutate(., region = "San Juan Islands") %>% 
  mutate(., est_catch = 0.10*value) %>% 
  left_join(., comp_tables_BV, by = c("region", "gear")) %>% 
  mutate(., catch_lbs = est_catch*yelloweye_prop) %>% 
  dplyr::select(-c(bocaccio_prop, REGION)) -> ye_SJI_21_33

# Bocaccio
yb_long %>% 
  subset(year <= 1933) %>% 
  mutate(., region = "San Juan Islands") %>% 
  mutate(., est_catch = 0.10*value) %>% 
  left_join(., comp_tables_BV, by = c("region", "gear")) %>% 
  mutate(., catch_lbs = est_catch*bocaccio_prop) %>% 
  dplyr::select(-c(yelloweye_prop, REGION)) -> boc_SJI_21_33

# Southern Puget Sound

# Yelloweye
yb_long %>% 
  subset(year <= 1933) %>% 
  mutate(., region = "Southern Puget Sound") %>% 
  mutate(., est_catch = 0.30*value) %>% 
  left_join(., comp_tables_BV, by = c("region", "gear")) %>% 
  mutate(., catch_lbs = est_catch*yelloweye_prop) %>% 
  dplyr::select(-c(bocaccio_prop, REGION)) -> ye_SPS_21_33

# Bocaccio
yb_long %>% 
  subset(year <= 1933) %>% 
  mutate(., region = "Southern Puget Sound") %>% 
  mutate(., est_catch = 0.30*value) %>% 
  left_join(., comp_tables_BV, by = c("region", "gear")) %>% 
  mutate(., catch_lbs = est_catch*bocaccio_prop) %>% 
  dplyr::select(-c(yelloweye_prop, REGION)) -> boc_SPS_21_33

# Strait of Juan de Fuca

# Yelloweye
yb_long %>% 
  subset(year <= 1933) %>% 
  mutate(., region = "Strait of Juan de Fuca") %>% 
  mutate(., est_catch = 0.05*value) %>% 
  left_join(., comp_tables_BV, by = c("region", "gear")) %>% 
  mutate(., catch_lbs = est_catch*yelloweye_prop) %>% 
  dplyr::select(-c(bocaccio_prop, REGION)) -> ye_JDF_21_33

# Bocaccio
yb_long %>% 
  subset(year <= 1933) %>% 
  mutate(., region = "Strait of Juan de Fuca") %>% 
  mutate(., est_catch = 0.05*value) %>% 
  left_join(., comp_tables_BV, by = c("region", "gear")) %>% 
  mutate(., catch_lbs = est_catch*bocaccio_prop) %>% 
  dplyr::select(-c(yelloweye_prop, REGION)) -> boc_JDF_21_33

# Join all yelloweye data together
ye_CPS_21_33 %>% 
  bind_rows(., ye_GB_21_33) %>% 
  # bind_rows(., ye_HC_21_33) %>% 
  bind_rows(., ye_JDF_21_33) %>% 
  bind_rows(., ye_SJI_21_33) %>% 
  bind_rows(., ye_SPS_21_33) %>% 
  mutate(., DPS = "U.S. DPS except Hood Canal") -> ye_21_33_estimates

ye_HC_21_33 %>% 
  mutate(., DPS = "Hood Canal") %>% 
  bind_rows(., ye_21_33_estimates) -> ye_21_33_estimates


boc_CPS_21_33 %>% 
  bind_rows(., boc_GB_21_33) %>% 
  bind_rows(., boc_HC_21_33) %>% 
  bind_rows(., boc_JDF_21_33) %>% 
  bind_rows(., boc_SJI_21_33) %>% 
  bind_rows(., boc_SPS_21_33) %>% 
  mutate(., DPS = "U.S. DPS") -> boc_21_33_estimates

# Sum across years, generate catch scenarios
ye_21_33_estimates %>% 
  group_by(year, DPS) %>% 
  summarise(catch_lbs = sum(catch_lbs, na.rm = TRUE)) %>% 
  mutate(., high_catch = catch_lbs * 2) %>% 
  mutate(., medium_catch = catch_lbs) %>% 
  mutate(., low_catch = catch_lbs * 0.5) -> ye_comm_21_33

boc_21_33_estimates %>% 
  group_by(year, DPS) %>% 
  summarise(catch_lbs = sum(catch_lbs, na.rm = TRUE)) %>% 
  mutate(., high_catch = catch_lbs * 2) %>% 
  mutate(., medium_catch = catch_lbs) %>% 
  mutate(., low_catch = catch_lbs * 0.5) -> boc_comm_21_33

```


## Commercial catch: All years combined

```{r combine_yelloweye_data, cache = TRUE}
ye_comm_21_33 %>% 
  bind_rows(., YE_BV_comm_1935_1954) %>% 
  bind_rows(., YE_comm_1955_1969) %>% 
  bind_rows(., YE_comm_1970_2003) %>% 
  bind_rows(., YE_comm_2004_2020) -> YE_comm_complete


boc_comm_21_33 %>% 
  bind_rows(., BOC_BV_comm_1935_1954) %>% 
  bind_rows(., BOC_comm_55_69) %>% 
  bind_rows(., BOC_comm_1970_2003) %>% 
  bind_rows(., shelf_RF_comm_2004_2020) -> BOC_comm_complete

```


# Recreational data

### Notes
- The recreational catch has been greater in magnitude than the commercial catch for both species for a large portion of the time series. 

### First step: load recreational conversion tables
Necessary for converting number of individuals to weight (kg or lbs)
```{r load_rec_conv_tables, cache = TRUE}
recreational_weight_conversion_path <- here("catch_reconstruction_data", "recreational", "Recreationalconversion.xls")
recreational_weight_conversion <- read_excel(recreational_weight_conversion_path, sheet = "Sheet1", skip = 1)
recreational_weight_conversion %>% 
  dplyr::rename(species = "...2") %>% 
  dplyr::select(-"...1") -> recreational_weight_conversion

# Extract values for yelloweye, bocaccio, all RF
YE_lbs_per_individual <- recreational_weight_conversion[recreational_weight_conversion$species == "Yelloweye rockfish",]$lbs
BOC_lbs_per_individual <- recreational_weight_conversion[recreational_weight_conversion$species == "Bocaccio",]$lbs
RF_lbs_per_individual <- recreational_weight_conversion[recreational_weight_conversion$species == "Misc. rockfish",]$lbs
```

### 2003-2019

#### Notes
This data was based on a creel survey of anglers. Catches are overall very low, but there are also high variances in the estimates. Yelloweye and Bocaccio catch scenarios are the same. Of additional note: there is a general rockfish category. Is it possible that some yelloweye or bocaccio are part of this category, despite them also having their own unique categories?

#### Main decisions for this time period:

1. Do we assume all released catch survived, or do we think that a portion of this value should be considered catch since many are likely to have had barotrauma and died? The main question is what proportion of discarded yelloweye or bocaccio were actually released at depth; Hochhalter and Reed (2011) estimated almost 99% survival of yelloweye rockfish released at depth, but only about 22% of yelloweye rockfish released at the surface.
2. Do we try to prorate the "general rockfish" category at all?
3. How do we combine estimates/variance from the four different "target type" categories ("other", "salmon", "bottom", "halibut").

#### Yelloweye/Bocaccio catch scenarios
Calculate catch/release/standard deviation for each target type and area individually; sum these for each year.

1. High catch: Creel estimate + one SD; 50% of estimated released rockfishes considered to be catch (died from barotrauma)
2. Medium catch: Creel estimate; 20% of estimated released rockfishes considered to be catch (died from barotrauma)
3. Low catch: Creel estimate - one SD; 5% of estimated released rockfishes considered to be catch (all released at depth, 95% survived - from Hannah et al. 2014, work done on yelloweye) 


```{r load_2003_2019_recreational, cache = TRUE}
# Read in sport landing data
PSP_sport_2003_2019_path <- here("catch_reconstruction_data", "recreational", "PSP Sport Estimates 2003-2019.xlsx")
PSP_sport_2003_2019 <- read_excel(PSP_sport_2003_2019_path, sheet = "All")

# Fix column names
names(PSP_sport_2003_2019) <- gsub(x = names(PSP_sport_2003_2019), pattern = "\r\n", replacement = "_")
names(PSP_sport_2003_2019) <- gsub(x = names(PSP_sport_2003_2019), pattern = "\\.", replacement = "")
names(PSP_sport_2003_2019) <- gsub(x = names(PSP_sport_2003_2019), pattern = " ", replacement = "_")

# Replace zeros with NAs for variance in catch when catch is zero
PSP_sport_2003_2019[PSP_sport_2003_2019$Est_Catch == 0,]$Var_Catch <- NA

# Calculate standard deviation for estimated catch and release
PSP_sport_2003_2019 %>% 
  mutate(., SD_catch = sqrt(Var_Catch)) %>% 
  mutate(., SD_release = sqrt(Var_Release)) -> PSP_sport_2003_2019

# Subset MCAs that are in DPS
# MCAs 4 and 5 are included in this data but are too far west to be in DPS (see Federal Register from 2017)
PSP_sport_all <- subset(PSP_sport_2003_2019, !(MCA %in% c("4", "5")))

# Keep only the relevant columns
PSP_sport_all %>% 
  dplyr::select(c(Year, MCA, Target_Type, Common_Name, Est_Catch, Var_Catch,Est_Release, Var_Release, SD_catch, SD_release)) %>% 
  dplyr::rename(year = Year) -> PSP_sport_all

YE_comm_complete
```

```{r yelloweye_recreational_2003_2019, cache = TRUE}
# Subset yelloweye
yelloweye_sport_2003_2019 <- subset(PSP_sport_all, Common_Name == "Yelloweye Rockfish")

unique(yelloweye_sport_2003_2019$MCA)
# Subset the Hood Canal population (only two data points, one from 2009 and one from 2016)
yelloweye_sport_2003_2019 %>% 
  subset(MCA == "12") %>% 
  mutate(., DPS = "Hood Canal") %>% 
  ungroup() %>% 
  rowwise() %>% 
  mutate(., high_catch_n = sum(Est_Catch, 1*SD_catch, 0.5*Est_Release, na.rm = TRUE)) %>% 
  mutate(., medium_catch_n = sum(Est_Catch, 0*SD_catch, 0.2*Est_Release, na.rm = TRUE)) %>% 
  mutate(., low_catch_n = sum(Est_Catch, -1*SD_catch, 0.05*Est_Release, na.rm = TRUE)) %>% 
  dplyr::select(year, DPS, high_catch_n, medium_catch_n, low_catch_n) %>% 
  complete(., year = seq(2003, 2019, 1), fill = list(high_catch_n = 0, medium_catch_n = 0, low_catch_n = 0, DPS = "Hood Canal")) %>% 
  # Convert individuals to weights
  mutate(., high_catch = high_catch_n * YE_lbs_per_individual) %>%
  mutate(., medium_catch = medium_catch_n * YE_lbs_per_individual) %>%
  mutate(., low_catch = low_catch_n * YE_lbs_per_individual) %>%
  dplyr::select(-c(high_catch_n, medium_catch_n, low_catch_n)) -> YE_HC_rec_2003_2019 

# U.S. DPS except Hood Canal
yelloweye_sport_2003_2019 %>% 
  subset(MCA != "12") %>% 
  ungroup() %>% 
  rowwise() %>% 
  mutate(., high_catch_n = sum(Est_Catch, 1*SD_catch, 0.5*Est_Release, na.rm = TRUE)) %>%
  mutate(., medium_catch_n = sum(Est_Catch, 0*SD_catch, 0.2*Est_Release, na.rm = TRUE)) %>% 
  mutate(., low_catch_n = sum(Est_Catch, -1*SD_catch, 0.05*Est_Release, na.rm = TRUE)) %>% 
  group_by(year) %>% 
  summarise(high_catch_n = sum(high_catch_n), medium_catch_n = sum(medium_catch_n), low_catch_n = sum(low_catch_n)) %>% 
  mutate(., DPS = "U.S. DPS except Hood Canal") %>% 
  complete(., year = seq(2003, 2019, 1), fill = list(high_catch_n = 0, medium_catch_n = 0, low_catch_n = 0, DPS = "U.S. DPS except Hood Canal")) %>% 
  # Convert individuals to weights
  mutate(., high_catch = high_catch_n * YE_lbs_per_individual) %>%
  mutate(., medium_catch = medium_catch_n * YE_lbs_per_individual) %>%
  mutate(., low_catch = low_catch_n * YE_lbs_per_individual) %>%
  dplyr::select(-c(high_catch_n, medium_catch_n, low_catch_n)) -> YE_USDPS_rec_2003_2019 

```


```{r bocaccio_recreational_2003_2019, cache = TRUE}
# Subset bocaccio
bocaccio_sport_2003_2019 <- subset(PSP_sport_all, Common_Name == "Bocaccio")

bocaccio_sport_2003_2019 %>% 
  ungroup() %>% 
  rowwise() %>% 
  mutate(., high_catch_n = sum(Est_Catch, 1*SD_catch, 0.5*Est_Release, na.rm = TRUE)) %>%
  mutate(., medium_catch_n = sum(Est_Catch, 0*SD_catch, 0.2*Est_Release, na.rm = TRUE)) %>% 
  mutate(., low_catch_n = sum(Est_Catch, -1*SD_catch, 0.05*Est_Release, na.rm = TRUE)) %>% 
  group_by(year) %>% 
  summarise(high_catch_n = sum(high_catch_n), medium_catch_n = sum(medium_catch_n), low_catch_n = sum(low_catch_n)) %>% 
  mutate(., DPS = "U.S. DPS") %>% 
  complete(., year = seq(2003, 2019, 1), fill = list(high_catch_n = 0, medium_catch_n = 0, low_catch_n = 0, DPS = "U.S. DPS")) %>% 
  # Convert individuals to weights
  mutate(., high_catch = high_catch_n * BOC_lbs_per_individual) %>%
  mutate(., medium_catch = medium_catch_n * BOC_lbs_per_individual) %>%
  mutate(., low_catch = low_catch_n * BOC_lbs_per_individual) %>%
  dplyr::select(-c(high_catch_n, medium_catch_n, low_catch_n)) -> BOC_USDPS_rec_2003_2019 
```

## 1994-2002

#### Notes:
From Palsson et al. 2009: 

"The foremost challenge in the last decade has been monitoring the dominant recreational fishery. Until 2004, bottomfish estimates from the WDFW recreational survey have depended upon open salmon fisheries and salmon catch record cards (Palsson 1988). This system necessitated year-round, open salmon fisheries to result in a complete estimate of bottomfish harvest by hook-and-line, boat-based fishers. Severe salmon fishery closures began in 1994 resulting in incomplete catch estimates for almost all catch areas until 2004 when a new catch estimation system was instituted."

"Beginning in 1994, large–scale closures occurred for the recreational salmon fishery, preventing successful bottomfish catch and effort estimates in many areas of Puget Sound. When an area is closed to recreational salmon fishing, there is no numerator to divide by then effort or bottomfish catch rate, preventing any point estimate of effort or bottomfish catch. Consequently, bottomfish catch and effort estimates have been severely underestimated from 1994 to 2003."

There were also major changes to the regulations regarding recreational rockfish fishing:

1. 1994: Rockfish daily bag limit reduced to five rockfish in North Sound and three in South Sound.
2. 2000: One rockfish bag limit enacted for all of Puget Sound east of Sekiu River. Emergency regulation temporarily increasing rockfish bag limit to 3 in Sekiu area to allow for black rockfish harvest.
3. 2002: May-Sept 30, west of Slip Point daily limit of 3, only 1 of which may be other than a black rockfish, permanent rule. Temporary prohibition of yelloweye and canary harvest.
4. 2003: Yelloweye and canary rockfish cannot be retained.

So how do we estimate the combined impact of under-reporting and these new regulations?

Here's another big problem: The data that I have is currently summed across "North Puget Sound" and "South Puget Sound". Hood Canal is included in "South Puget Sound". I'm sure this was summed at some point from finer resolution data, but can we find that data? We also don't know exactly how much of the Strait of Juan de Fuca is included in "North Puget Sound" - should follow up with Wayne Palsson. I also need to know why the catch is prorated into species for 1970-1985 but not 1986-2002.

- The creel survey data exists from 2003-present - not sure exactly what the one year difference is? Or perhaps the survey started in 2004, but collected data for 2003?
- Clearly the estimates from 1994 to 2002 are an underestimate - but how can we correct for this? We can use the 1994-2002 data as the minimum catch, and multiply catches by a certain factor for the medium and high catch scenarios. But by what factor do we multiply this? Perhaps we can get some information from the amount of salmon fishing effort relative to historical levels?

#### Yelloweye/Bocaccio catch scenarios
For this time period, we will prorate catches based on composition data and subsequently multiply by a factor to account for under-reporting. Will need to check in with Greg Lippert/Wayne Palsson to get their thoughts on this, since these are arbitrary values...

1. High catch: Prorated estimate x 3.
2. Medium catch: Prorated estimate x 2.
3. Low catch: Prorated estimate x 1.

```{r load_rec_catch_70_09, cache=TRUE}
# Load catch numbers
rec_catch_nos_path <- here("catch_reconstruction_data", "recreational", "rec_catch_numbers_1970_2009.xlsx")

rec_NPS <- read_excel(rec_catch_nos_path, sheet = "North Sound")
rec_NPS[is.na(rec_NPS)] <- 0
rec_SPS <- read_excel(rec_catch_nos_path, sheet = "South Sound")
rec_SPS[is.na(rec_SPS)] <- 0

# Load species composition data
rec_spp_comp_NPS_path <- here("catch_reconstruction_data", "recreational", "north_sound_rec_comps.xlsx")
rec_spp_comp_SPS_path <- here("catch_reconstruction_data", "recreational", "south_sound_rec_comps.xlsx")
# Mean across time periods
rec_mean_spp_comp_path <- here("catch_reconstruction_data", "recreational", "mean_rec_comps.xlsx")

# Load data, replace all NAs with 0s
rec_spp_comp_NPS <- read_excel(rec_spp_comp_NPS_path)
rec_spp_comp_NPS[is.na(rec_spp_comp_NPS)] <- 0
rec_spp_comp_SPS <- read_excel(rec_spp_comp_SPS_path)
rec_spp_comp_SPS[is.na(rec_spp_comp_SPS)] <- 0
rec_mean_spp_comp_NPS <- read_excel(rec_mean_spp_comp_path, sheet = "North Sound")
rec_mean_spp_comp_NPS[is.na(rec_mean_spp_comp_NPS)] <- 0
rec_mean_spp_comp_SPS <- read_excel(rec_mean_spp_comp_path, sheet = "South Sound")
rec_mean_spp_comp_SPS[is.na(rec_mean_spp_comp_SPS)] <- 0

# Generate species composition data for the time period 1996-2002, since this is the overlap with this period.

### NORTH PUGET SOUND

# Get sample sizes for each year
NPS_rec_sample_sizes <- as.numeric(rec_spp_comp_NPS[rec_spp_comp_NPS$Species == "Sample Size",][2:dim(rec_spp_comp_NPS)[2]])

rec_spp_comp_NPS %>%
  t() %>% 
  as.data.frame() %>% 
  row_to_names(row_number = 1) %>% 
  mutate_all(., as.numeric) %>% 
  dplyr::select(-`Sample Size`) %>% 
  # Multiply by vector of sample sizes
  as.matrix() * 0.01 * NPS_rec_sample_sizes -> rec_spp_comp_NPS_numbers

as.data.frame(rec_spp_comp_NPS_numbers) %>% 
  rownames_to_column("year") %>% 
  mutate(year = as.numeric(year)) %>% 
  subset(year <= 2002 & year >= 1994) %>% 
  mutate(sample_size = rowSums(.)-year) %>% 
  # Summarise across all years
  colSums() %>% 
  as.data.frame() %>% 
  dplyr::rename(., total = `.`) %>% 
  rownames_to_column(., "Species") %>% 
  subset(., Species != "year") %>% 
  mutate(., proportion = total/subset(.,Species == "sample_size")$total) %>% 
  subset(., Species != "sample_size")-> NPS_rec_spp_comp_props_96_02

### SOUTH PUGET SOUND

# Get sample sizes for each year
SPS_rec_sample_sizes <- as.numeric(rec_spp_comp_SPS[rec_spp_comp_SPS$Species == "Sample size",][2:dim(rec_spp_comp_SPS)[2]])

rec_spp_comp_SPS %>%
  t() %>% 
  as.data.frame() %>% 
  row_to_names(row_number = 1) %>% 
  mutate_all(., as.numeric) %>% 
  dplyr::select(-`Sample size`) %>% 
  # Multiply by vector of sample sizes
  as.matrix() * 0.01 * SPS_rec_sample_sizes -> rec_spp_comp_SPS_numbers

as.data.frame(rec_spp_comp_SPS_numbers) %>% 
  rownames_to_column("year") %>% 
  mutate(year = as.numeric(year)) %>% 
  subset(year <= 2002 & year >= 1994) %>% 
  mutate(sample_size = rowSums(.)-year) %>% 
  # Summarise across all years
  colSums() %>% 
  as.data.frame() %>% 
  dplyr::rename(., total = `.`) %>% 
  rownames_to_column(., "Species") %>% 
  subset(., Species != "year") %>% 
  mutate(., proportion = total/subset(.,Species == "sample_size")$total) %>% 
  subset(., Species != "sample_size")-> SPS_rec_spp_comp_props_96_02
```

```{r prorate_catch_by_comps}
# North Sound
rec_NPS %>% 
  subset(., Year >= 1994 & Year <= 2002) %>% 
  dplyr::select(Year, `Bocaccio`, `Yelloweye Rockfish`, `Rockfish - General`) -> rec_NPS_94_02

# Add the catch composition data
rec_NPS_94_02$boc_prop <- subset(NPS_rec_spp_comp_props_96_02, Species == "Bocaccio")$proportion
rec_NPS_94_02$ye_prop <- subset(NPS_rec_spp_comp_props_96_02, Species == "Yelloweye")$proportion


# Yelloweye: Prorate, catch scenarios, estimate weight
rec_NPS_94_02 %>% 
  dplyr::rename(year = Year, total = `Rockfish - General`) %>%
  mutate(., high_catch_n = (`Yelloweye Rockfish` + total*ye_prop)*3) %>%
  mutate(., medium_catch_n = (`Yelloweye Rockfish` + total*ye_prop)*2) %>%
  mutate(., low_catch_n = (`Yelloweye Rockfish` + total*ye_prop)*1) %>%
  mutate(., high_catch = high_catch_n*YE_lbs_per_individual) %>% 
  mutate(., medium_catch = medium_catch_n*YE_lbs_per_individual) %>% 
  mutate(., low_catch = low_catch_n*YE_lbs_per_individual) %>% 
  dplyr::select(-c(high_catch_n, medium_catch_n, low_catch_n, boc_prop, ye_prop)) -> ye_rec_NPS_94_02

# Bocaccio: Prorate, catch scenarios, estimate weight
rec_NPS_94_02 %>% 
  dplyr::rename(year = Year, total = `Rockfish - General`) %>%
  mutate(., high_catch_n = (`Bocaccio` + total*boc_prop)*3) %>%
  mutate(., medium_catch_n = (`Bocaccio` + total*boc_prop)*2) %>%
  mutate(., low_catch_n = (`Bocaccio` + total*boc_prop)*1) %>%
  mutate(., high_catch = high_catch_n*BOC_lbs_per_individual) %>% 
  mutate(., medium_catch = medium_catch_n*BOC_lbs_per_individual) %>% 
  mutate(., low_catch = low_catch_n*BOC_lbs_per_individual) %>% 
  dplyr::select(-c(high_catch_n, medium_catch_n, low_catch_n, boc_prop, ye_prop)) -> boc_rec_NPS_94_02
  

# South Sound
rec_SPS %>% 
  subset(., Year >= 1994 & Year <= 2002) %>% 
  dplyr::select(Year, `Bocaccio`, `Yelloweye Rockfish`, `Rockfish - General`) -> rec_SPS_94_02

# Add the catch composition data
rec_SPS_94_02$boc_prop <- subset(SPS_rec_spp_comp_props_96_02, Species == "Bocaccio")$proportion
rec_SPS_94_02$ye_prop <- subset(SPS_rec_spp_comp_props_96_02, Species == "Yelloweye")$proportion

# Yelloweye: Prorate, catch scenarios, estimate weight
rec_SPS_94_02 %>% 
  dplyr::rename(year = Year, total = `Rockfish - General`) %>%
  mutate(., high_catch_n = (`Yelloweye Rockfish` + total)*ye_prop*3) %>%
  mutate(., medium_catch_n = (`Yelloweye Rockfish` + total)*ye_prop*2) %>%
  mutate(., low_catch_n = (`Yelloweye Rockfish` + total)*ye_prop*1) %>%
  mutate(., high_catch = high_catch_n*YE_lbs_per_individual) %>% 
  mutate(., medium_catch = medium_catch_n*YE_lbs_per_individual) %>% 
  mutate(., low_catch = low_catch_n*YE_lbs_per_individual) %>% 
  dplyr::select(-c(high_catch_n, medium_catch_n, low_catch_n, boc_prop, ye_prop)) -> ye_rec_SPS_94_02

# Bocaccio: Prorate, catch scenarios, estimate weight
rec_SPS_94_02 %>% 
  dplyr::rename(year = Year, total = `Rockfish - General`) %>%
  mutate(., high_catch_n = (`Bocaccio` + total*boc_prop)*3) %>%
  mutate(., medium_catch_n = (`Bocaccio` + total*boc_prop)*2) %>%
  mutate(., low_catch_n = (`Bocaccio` + total*boc_prop)*1) %>%
  mutate(., high_catch = high_catch_n*BOC_lbs_per_individual) %>% 
  mutate(., medium_catch = medium_catch_n*BOC_lbs_per_individual) %>% 
  mutate(., low_catch = low_catch_n*BOC_lbs_per_individual) %>% 
  dplyr::select(-c(high_catch_n, medium_catch_n, low_catch_n, boc_prop, ye_prop)) -> boc_rec_SPS_94_02
  
```


## 1970-1993

#### Notes
Wayne Palsson does not seem to have a high degree of confidence for the recreational catch for this time period; however, there is also no indication of how to quantitatively address this uncertainty.

Catch composition data for the recreational fishery exists for 1980-1986 and 1989 for this time period; the next compositional data is from 1996. We will use all compositional data from 1980-1986 and 1989 to prorate catches for this time period. There is also some catch composition data for 1965-1967; see PDF page 108 from Palsson et al. 2009, with the original data from Buckley (1967, 1968); Buckley and Satterthwaite (1970).

#### Yelloweye and Bocaccio catch scenarios
There is only one catch scenario for yelloweye and bocaccio.


```{r rec_catch_comp_data_70_93}
# North Sound
as.data.frame(rec_spp_comp_NPS_numbers) %>% 
  rownames_to_column("year") %>% 
  mutate(year = as.numeric(year)) %>% 
  subset(year <= 1989 & year >= 1980) %>% 
  mutate(sample_size = rowSums(.)-year) %>% 
  # Summarise across all years
  colSums() %>% 
  as.data.frame() %>% 
  dplyr::rename(., total = `.`) %>% 
  rownames_to_column(., "Species") %>% 
  subset(., Species != "year") %>% 
  mutate(., proportion = total/subset(.,Species == "sample_size")$total) %>% 
  subset(., Species != "sample_size")-> NPS_rec_spp_comp_props_80_89

# South Sound
as.data.frame(rec_spp_comp_SPS_numbers) %>% 
  rownames_to_column("year") %>% 
  mutate(year = as.numeric(year)) %>% 
  subset(year <= 1989 & year >= 1980) %>% 
  mutate(sample_size = rowSums(.)-year) %>% 
  # Summarise across all years
  colSums() %>% 
  as.data.frame() %>% 
  dplyr::rename(., total = `.`) %>% 
  rownames_to_column(., "Species") %>% 
  subset(., Species != "year") %>% 
  mutate(., proportion = total/subset(.,Species == "sample_size")$total) %>% 
  subset(., Species != "sample_size")-> SPS_rec_spp_comp_props_80_89


```



```{r prorate_rec_catch_70_93}
# Use the same data files as were previously loaded for the 1994-2002 data

# North Sound
rec_NPS %>% 
  subset(., Year >= 1970 & Year <= 1993) %>% 
  dplyr::select(Year, `Bocaccio`, `Yelloweye Rockfish`, `Rockfish - General`) -> rec_NPS_70_93

# Add the catch composition data
rec_NPS_70_93$boc_prop <- subset(NPS_rec_spp_comp_props_80_89, Species == "Bocaccio")$proportion
rec_NPS_70_93$ye_prop <- subset(NPS_rec_spp_comp_props_80_89, Species == "Yelloweye")$proportion


# Yelloweye: Prorate, catch scenarios, estimate weight
rec_NPS_70_93 %>% 
  dplyr::rename(year = Year, total = `Rockfish - General`) %>%
  mutate(., high_catch_n = (`Yelloweye Rockfish` + total*ye_prop)*1) %>%
  mutate(., medium_catch_n = (`Yelloweye Rockfish` + total*ye_prop)*1) %>%
  mutate(., low_catch_n = (`Yelloweye Rockfish` + total*ye_prop)*1) %>%
  mutate(., high_catch = high_catch_n*YE_lbs_per_individual) %>% 
  mutate(., medium_catch = medium_catch_n*YE_lbs_per_individual) %>% 
  mutate(., low_catch = low_catch_n*YE_lbs_per_individual) %>% 
  dplyr::select(-c(high_catch_n, medium_catch_n, low_catch_n, boc_prop, ye_prop)) -> ye_rec_NPS_70_93

# Bocaccio: Prorate, catch scenarios, estimate weight
rec_NPS_70_93 %>% 
  dplyr::rename(year = Year, total = `Rockfish - General`) %>%
  mutate(., high_catch_n = (`Bocaccio` + total*boc_prop)*1) %>%
  mutate(., medium_catch_n = (`Bocaccio` + total*boc_prop)*1) %>%
  mutate(., low_catch_n = (`Bocaccio` + total*boc_prop)*1) %>%
  mutate(., high_catch = high_catch_n*BOC_lbs_per_individual) %>% 
  mutate(., medium_catch = medium_catch_n*BOC_lbs_per_individual) %>% 
  mutate(., low_catch = low_catch_n*BOC_lbs_per_individual) %>% 
  dplyr::select(-c(high_catch_n, medium_catch_n, low_catch_n, boc_prop, ye_prop)) -> boc_rec_NPS_70_93
  

# South Sound
rec_SPS %>% 
  subset(., Year >= 1970 & Year <= 1993) %>% 
  dplyr::select(Year, `Bocaccio`, `Yelloweye Rockfish`, `Rockfish - General`) -> rec_SPS_70_93

# Add the catch composition data
rec_SPS_70_93$boc_prop <- subset(SPS_rec_spp_comp_props_80_89, Species == "Bocaccio")$proportion
rec_SPS_70_93$ye_prop <- subset(SPS_rec_spp_comp_props_80_89, Species == "Yelloweye")$proportion

# Yelloweye: Prorate, catch scenarios, estimate weight
rec_SPS_70_93 %>% 
  dplyr::rename(year = Year, total = `Rockfish - General`) %>%
  mutate(., high_catch_n = (`Yelloweye Rockfish` + total*ye_prop)*1) %>%
  mutate(., medium_catch_n = (`Yelloweye Rockfish` + total*ye_prop)*1) %>%
  mutate(., low_catch_n = (`Yelloweye Rockfish` + total*ye_prop)*1) %>%
  mutate(., high_catch = high_catch_n*YE_lbs_per_individual) %>% 
  mutate(., medium_catch = medium_catch_n*YE_lbs_per_individual) %>% 
  mutate(., low_catch = low_catch_n*YE_lbs_per_individual) %>% 
  dplyr::select(-c(high_catch_n, medium_catch_n, low_catch_n, boc_prop, ye_prop)) -> ye_rec_SPS_70_93

# Bocaccio: Prorate, catch scenarios, estimate weight
rec_SPS_70_93 %>% 
  dplyr::rename(year = Year, total = `Rockfish - General`) %>%
  mutate(., high_catch_n = (`Bocaccio` + total*boc_prop)*1) %>%
  mutate(., medium_catch_n = (`Bocaccio` + total*boc_prop)*1) %>%
  mutate(., low_catch_n = (`Bocaccio` + total*boc_prop)*1) %>%
  mutate(., high_catch = high_catch_n*BOC_lbs_per_individual) %>% 
  mutate(., medium_catch = medium_catch_n*BOC_lbs_per_individual) %>% 
  mutate(., low_catch = low_catch_n*BOC_lbs_per_individual) %>% 
  dplyr::select(-c(high_catch_n, medium_catch_n, low_catch_n, boc_prop, ye_prop)) -> boc_rec_SPS_70_93
  
```


## Pre-1970

We know that there was some recreational catch for this time period, but it was not documented.

#### Notes
In all of the Buckley documents, yelloweye rockfish is called "Rasphead rockfish". Catch statistics by area since 1965.

Wayne Palsson says this about the Buckley papers: "Early species composition observations are available for 1965 to 1967 based on expanded harvest estimates (Buckley 1967, 1968; Buckley and Satterthwaite 1970) and offer a glimpse into earlier species proportions of the rockfish harvest in North and South Puget Sound. Samplers at that time were developing their basis of species identifications and some observations may be questionable."

#### Yelloweye and Bocaccio catch scenarios
1968-1969: high = all unclassified rockfish prorated, medium = half of unclassified rockfish prorate,d low = no unclassified rockfish prorated.



##### Buckley docs (1965-1967)
Buckley (1967) - 1965 recreational bottomfish fishery:
- Distinction between "incidental" and "specific" harvests:
  - "Bottomfish caught while actively angling for salmon were incidental harvests."
  - "Bottomfish caught while actively angling for species other than salmon were specific harvests."
- "The Washington sport-angling harvest of marine bottomfish, also referred to as "nonsalmon food fish", has been considered of negligible importance in our management scheme and very little effort was expended in this direction through 1964. In early 1965, however, the recreation potential offered by bottomfish species and their future importance in the rapidly expanding Washington sport fishery prompted the inclusion of their harvest in the regular sampling of the salmon-sport fishery."
- "At present, the majority of Washington's sport anglers consider most bottomfish as "scrap fish" and the ratio of the number retained in the harvest to the number actually caught appears extremely low in all areas."
  - Possible that catch is underestimate of total fishing mortality of rockfishes, given barotrauma
- "1965 was the first year State-wide bottomfish harvests were calculated"


Buckley and Sattherwhaite (1970) - 1967 recreational bottomfish fishery:
- See marine area codes on page 40. Regions 6-12 are the DPS. Region 13 was not added until 1976, according to Palsson 1987 - prior to 1976, region 12 encompassed regions 12 and 13.
- "Any specific bottomfish angling in these areas in previous years was apparently at a level low enough to remain undetected at past sampling intensities. Sampling procedures and manpower levels did not change significantly in these areas in 1967, indicating a substantial increase in specific bottomfish angling."
- "The calculated total sport harvest of 276,837 bottomfish in 1967 was a 15% increase over the 1966 catch of 250,483 fish, the only other year for which state-wide figures are available."
- "Rockfish were the dominant family, contributing more than 54% of the total incidental harvest."
- "Rockfish were the dominant family, accounting for more than 43% of the total specific harvest."


#### Bargmann tables (1968-1973)
- Use years 1968 and 1969. Data is available in Google Drive here (old fishery records and analysis): https://docs.google.com/spreadsheets/d/0B3NnRv_9_F9sNG1ITG1fQU5ZUFk/edit#gid=1104389180


##### WDFW Annual Bulletins

1940 report:
- "Approximately 60% of the resorts reported regularly on a purely voluntary basis... It should be noted that all individual catches brought in to any given resort cannot be recorded by the manager. For that reason the catch statistics given below can be assumed to constitute only a very conservative record of the number of fish caught by recreational fishermen fishing from the various resorts."
- "In estimating the total sports catch of any species for 1940, allowance must be made for (a) 43% of known boathouses not reporting during the eight-months period above, (b) four additional months to complete the year, and (c) catches made by persons not using boathouse facilities.
  - Tables indicate the in each year, somewhere between 30% and 60% of total known boathouses are reporting.
- "While statistics of sports catches kept by the Department of Fisheries on the present basis provide the basis of reasonable estimates, **the data are by no means complete or accurate**." 

### Bargmann (1968-1969)
Sheets are numbered according to the table numbers in the document.

Tables of interest:
- Table 9: Area 6 (Strait of Juan de Fuca) incidental catch
- Table 10: Area 6 (Strait of Juan de Fuca) specific catch
- Table 11: Area 7 (SJI) incidental catch
- Table 12: Area 7 (SJI) specific catch
- Table 13: Area 8 (Deception Pass and Hope Island) incidental catch
- Table 14: Area 8 (Deception Pass and Hope Island) specific catch
- Table 15: Area 9 (Admirality Inlet, Possession Sound, Saratoga Passage, Port Susan/North Puget Sound) incidental catch
- Table 16: Area 9 (Admirality Inlet, Possession Sound, Saratoga Passage, Port Susan/North Puget Sound) specific catch
- Table 17: Area 10 (Seattle and Bremerton/Central Puget Sound) incidental catch
- Table 18: Area 10 (Seattle and Bremerton/Central Puget Sound) specific catch
- Table 19: Area 11 (South Puget Sound) incidental catch
- Table 20: Area 11 (South Puget Sound) specific catch
- Table 21: Area 12 (Hood Canal) incidental catch
- Table 22: Area 12 (Hood Canal) specific catch

Need to skip first four rows, and first column.

```{r load_bargmann_data}
bargmann_path <- here("catch_reconstruction_data", "recreational", "pre_1970", "Bargman tables.xls")

JDF_inc <- read_excel(bargmann_path, sheet = 9, skip = 4)
JDF_spe <- read_excel(bargmann_path, sheet = 10, skip = 4)
SJI_inc <- read_excel(bargmann_path, sheet = 11, skip = 4)
SJI_spe <- read_excel(bargmann_path, sheet = 12, skip = 4)
DPHI_inc <- read_excel(bargmann_path, sheet = 13, skip = 4)
DPHI_spe <- read_excel(bargmann_path, sheet = 14, skip = 4)
NPS_inc <- read_excel(bargmann_path, sheet = 15, skip = 4)
NPS_spe <- read_excel(bargmann_path, sheet = 16, skip = 4)
CPS_inc <- read_excel(bargmann_path, sheet = 17, skip = 4)
CPS_spe <- read_excel(bargmann_path, sheet = 18, skip = 4)
SPS_inc <- read_excel(bargmann_path, sheet = 19, skip = 4)
SPS_spe <- read_excel(bargmann_path, sheet = 20, skip = 4)
HC_inc <- read_excel(bargmann_path, sheet = 21, skip = 4)
HC_spe <- read_excel(bargmann_path, sheet = 22, skip = 4)

# Make some edits/re-format
JDF_inc %>% 
  mutate(take = "incidental", area = 6) %>% 
  dplyr::select(-c(`Annual Avg`, `Percent of Total`, `1970`, `1971`, `1972`, `1973`)) -> JDF_inc
JDF_spe %>% 
  mutate(take = "specific", area = 6) %>% 
  dplyr::select(-c(`Annual Avg`, `Percent of Total`, `1970`, `1971`, `1972`, `1973`)) -> JDF_spe
SJI_inc %>% 
  mutate(take = "incidental", area = 7) %>% 
  dplyr::select(-c(`Annual Avg`, `Percent of Total`, `1970`, `1971`, `1972`, `1973`)) -> SJI_inc
SJI_spe %>% 
  mutate(take = "specific", area = 7) %>% 
  dplyr::select(-c(`Annual Avg`, `Percent of Total`, `1970`, `1971`, `1972`, `1973`)) -> SJI_spe
DPHI_inc %>% 
  mutate(take = "incidental", area = 8) %>% 
  dplyr::select(-c(`Annual Avg`, `Percent of Total`, `1970`, `1971`, `1972`, `1973`)) -> DPHI_inc
DPHI_spe %>% 
  mutate(take = "specific", area = 8) %>% 
  dplyr::select(-c(`Annual Avg`, `Percent of Total`, `1970`, `1971`, `1972`, `1973`)) -> DPHI_spe
NPS_inc %>% 
  mutate(take = "incidental", area = 9) %>% 
  dplyr::select(-c(`Annual Avg`, `Percent of Total`, `1970`, `1971`, `1972`, `1973`)) -> NPS_inc
NPS_spe %>% 
  mutate(take = "specific", area = 9) %>% 
  dplyr::select(-c(`Annual Avg`, `Percent of Total`, `1970`, `1971`, `1972`, `1973`)) -> NPS_spe
CPS_inc %>% 
  mutate(take = "incidental", area = 10) %>% 
  dplyr::select(-c(`Annual Avg`, `Percent of Total`, `1970`, `1971`, `1972`, `1973`)) -> CPS_inc
CPS_spe %>% 
  mutate(take = "specific", area = 10) %>% 
  dplyr::select(-c(`Annual Avg`, `Percent of Total`, `1970`, `1971`, `1972`, `1973`)) -> CPS_spe
SPS_inc %>% 
  mutate(take = "incidental", area = 11) %>% 
  dplyr::select(-c(`Annual Avg`, `Percent of Total`, `1970`, `1971`, `1972`, `1973`)) -> SPS_inc
SPS_spe %>% 
  mutate(take = "specific", area = 11) %>% 
  dplyr::select(-c(`Annual Avg`, `Percent of Total`, `1970`, `1971`, `1972`, `1973`)) -> SPS_spe
HC_inc %>% 
  mutate(take = "incidental", area = 12) %>% 
  dplyr::select(-c(`Annual Avg`, `Percent of Total`, `1970`, `1971`, `1972`, `1973`)) -> HC_inc
HC_spe %>% 
  mutate(take = "specific", area = 12) %>% 
  dplyr::select(-c(`Annual Avg`, `Percent of Total`, `1970`, `1971`, `1972`, `1973`)) -> HC_spe

# Join together all
JDF_inc  %>% 
  bind_rows(., JDF_spe) %>% 
  bind_rows(., SJI_inc) %>% 
  bind_rows(., SJI_spe) %>% 
  bind_rows(., DPHI_inc) %>% 
  bind_rows(., DPHI_spe) %>% 
  bind_rows(., NPS_inc) %>% 
  bind_rows(., NPS_spe) %>% 
  bind_rows(., CPS_inc) %>% 
  bind_rows(., CPS_spe) %>% 
  bind_rows(., SPS_inc) %>% 
  bind_rows(., SPS_spe) %>% 
  bind_rows(., HC_inc) %>% 
  bind_rows(., HC_spe) -> bargmann_data

# combine years into one column
bargmann_data %>% 
  pivot_longer(., cols = c(`1968`, `1969`), names_to = "year") %>% 
  dplyr::rename(catch_individuals = value) -> bargmann_data

# Remove the irrelevant species
bargmann_data %>% 
  subset(Species %in% c("Rockfish- unlcassified", "Rockfish-unclassified", "Rockfish- unclassified", "Rockfish unclassified", "Yelloweye rockfish", "Bocaccio", "Boccacio")) %>% 
  mutate(Species = ifelse(Species %in% c("Bocaccio", "Boccacio"), "Bocaccio", Species)) %>% 
  mutate(Species = ifelse(Species %in% c("Rockfish- unlcassified", "Rockfish-unclassified", "Rockfish- unclassified", "Rockfish unclassified"), "unclassified rockfish", Species)) -> bargmann_data

# Replace all NAs with zeros
bargmann_data[is.na(bargmann_data$catch_individuals),]$catch_individuals <- 0
unique(bargmann_data$area)
# Add a North Puget Sound vs. South Puget Sound column for prorating catch
bargmann_data %>% 
  mutate(., PS = ifelse(area %in% c(8,9,10,11,12), "South Puget Sound", "North Puget Sound")) -> bargmann_data
```

```{r summarise_data}
# Summarise across regions
bargmann_data %>% 
  group_by(year, Species, PS) %>% 
  summarise(total_catch = sum(catch_individuals)) -> bargmann_annual_sums

# Prorate catch according to 1965-1967 comp data
# Add the catch composition data
bargmann_annual_sums %>% 
  mutate(boc_prop = ifelse(PS == "North Puget Sound", subset(rec_mean_spp_comp_NPS, Species == "Bocaccio")$`1965-1967a`/100, subset(rec_mean_spp_comp_SPS, Species == "Bocaccio")$`1965-1967a`/100)) %>% 
  mutate(ye_prop = ifelse(PS == "North Puget Sound", subset(rec_mean_spp_comp_NPS, Species == "Yelloweye")$`1965-1967a`/100, subset(rec_mean_spp_comp_SPS, Species == "Yelloweye")$`1965-1967a`/100)) -> bargmann_annual_sums


# Prorate and summarise for yelloweye
bargmann_annual_sums %>% 
  subset(Species %in% c("unclassified rockfish", "Yelloweye rockfish")) %>% 
  mutate(., catch = ifelse(Species == "Yelloweye rockfish", total_catch, ye_prop*total_catch)) %>% 
  group_by(year) %>% 
  summarise(catch = sum(catch)) %>% 
  mutate(catch_lbs = catch*YE_lbs_per_individual) -> ye_catch_bargmann

# Prorate and summarise for bocaccio
bargmann_annual_sums %>% 
  subset(Species %in% c("unclassified rockfish", "Bocaccio")) %>% 
  mutate(., catch = ifelse(Species == "Bocaccio", total_catch, boc_prop*total_catch)) %>% 
  group_by(year) %>% 
  summarise(catch = sum(catch)) %>% 
  mutate(catch_lbs = catch*BOC_lbs_per_individual) -> boc_catch_bargmann
  
```





